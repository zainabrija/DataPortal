{% extends "base.html" %} {% block title %}Request Data - PBS Data Portal{%
endblock %} {% block content %}
<div class="container py-5">
  <h1 class="mb-4 fw-bold text-primary">PBS Data Request Form</h1>

  <form method="POST" class="form-container">
    <!-- Personal Details Section -->
    <div class="section-header mb-3">Personal Details</div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="name" class="form-label">Name *</label>
          <input
            type="text"
            class="form-control"
            id="name"
            name="name"
            value="{{ current_user.name }}"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="cnic" class="form-label">CNIC *</label>
          <input
            type="text"
            class="form-control"
            id="cnic"
            name="cnic"
            value="{{ current_user.cnic }}"
            placeholder="12345-1234567-1"
            required
          />
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="department" class="form-label"
            >Department/Organization *</label
          >
          <input
            type="text"
            class="form-control"
            id="department"
            name="department"
            value="{{ current_user.department }}"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="email" class="form-label">Email Address *</label>
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            value="{{ current_user.email }}"
            required
          />
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="phone" class="form-label">Phone Number *</label>
          <input
            type="tel"
            class="form-control"
            id="phone"
            name="phone"
            value="{{ current_user.phone }}"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="whatsapp" class="form-label"
            >WhatsApp Contact Number (for important updates) *</label
          >
          <input
            type="tel"
            class="form-control"
            id="whatsapp"
            name="whatsapp"
            value="{{ current_user.whatsapp }}"
            placeholder="e.g. +92XXXXXXXXXX"
            required
          />
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="city" class="form-label">City *</label>
          <input
            type="text"
            class="form-control"
            id="city"
            name="city"
            value="{{ current_user.city }}"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="district" class="form-label">District *</label>
          <input
            type="text"
            class="form-control"
            id="district"
            name="district"
            value="{{ current_user.district }}"
            required
          />
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="province" class="form-label">Province *</label>
          <input
            type="text"
            class="form-control"
            id="province"
            name="province"
            value="{{ current_user.province }}"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="nationality" class="form-label">Nationality *</label>
          <input
            type="text"
            class="form-control"
            id="nationality"
            name="nationality"
            value="{{ current_user.nationality }}"
            required
          />
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label for="mailing_address" class="form-label">Mailing Address</label>
      <textarea
        class="form-control"
        id="mailing_address"
        name="mailing_address"
        rows="3"
      >
{{ current_user.mailing_address or '' }}</textarea
      >
    </div>

    <!-- Data Request Details Section -->
    <div class="section-header mb-3 mt-4">Data Request Details</div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="dataset_name" class="form-label">Dataset Name *</label>
          <input
            type="text"
            class="form-control"
            id="dataset_name"
            name="dataset_name"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="purpose" class="form-label"
            >Purpose of the Request *</label
          >
          <select class="form-select" id="purpose" name="purpose" required>
            <option value="">Select Purpose</option>
            <option value="Research">Research</option>
            <option value="Business">Business</option>
            <option value="Academic">Academic</option>
            <option value="Government">Government</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="pbs_section" class="form-label">PBS Section *</label>
          <select
            class="form-select"
            id="pbs_section"
            name="pbs_section"
            required
          >
            <option value="Data Processing">Data Processing</option>
            <option value="Data Center">Data Center</option>
            <option value="Call Center">Call Center</option>
            <option value="Business Register">Business Register</option>
            <option value="Sample Design">Sample Design</option>
            <option value="Media Cell">Media Cell</option>
            <option value="Agriculture Section">Agriculture Section</option>
            <option value="CP&L">CP&L</option>
            <option value="Social Statistics">Social Statistics</option>
            <option value="Demographics Section">Demographics Section</option>
            <option value="Labor Force">Labor Force</option>
            <option value="HIES">HIES</option>
            <option value="Health Account">Health Accounts</option>
            <option value="Economic Census">Economic Census</option>
            <option value="Industry Section">Industry Section</option>
            <option value="Mining Section">Mining Section</option>
            <option value="DDSS">DDSS</option>
            <option value="Price Cell">Price Cell</option>
            <option value="CPMU">CPMU</option>
            <option value="Crop Reporting">Crop Reporting</option>
            <option value="National Account">National Account</option>
            <option value="Demographics Section">Demographics Section</option>
            <option value="PSLM">PSLM</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Data Type Selection Section -->
    <div class="section-header mb-3 mt-4">Data Type Selection</div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="data_type" class="form-label">Select Data Type *</label>
          <select class="form-select" id="data_type" name="data_type" required>
            <option value="">Select Data Type</option>

            <!-- Maps Category -->
            <option value="Maps">Maps</option>
            <option value="Microdata">Microdata</option>
            <option value="Blocks">Blocks</option>
            <option value="Tabular Data">Tabular Data</option>
            <option value="Methodology/Questionere">
              Methodology/Questionere
            </option>
            <option value="Publications">Publications</option>
            <option value="Polygons">Polygons</option>
            <option value="Summaries">Summaries</option>
            <option value="Charts">Charts</option>
            <option value="API">API</option>
          </select>
        </div>
      </div>

      <div class="col-md-6">
        <div class="mb-3">
          <label for="available_data" class="form-label"
            >Available Data *</label
          >
          <select
            class="form-select"
            id="available_data"
            name="available_data"
            required
          >
            <option value="">Select Available Data</option>
            <option value="Child Labour Survey Graph">
              Child Labour Survey Graph
            </option>
            <option value="Population Census 2023">
              Population Census 2023
            </option>
            <option value="Population Census">Population Census</option>
            <option value="Agriculture Census">Agriculture Census</option>
            <option value="Agriculture Statistics">
              Agriculture Statistics
            </option>
            <option value="Business Register">Business Register</option>
            <option value="Demographic and Research">
              Demographic and Research
            </option>
            <option value="Energy & Mining Statistics">
              Energy & Mining Statistics
            </option>
            <option value="External Trade Statistics">
              External Trade Statistics
            </option>
            <option value="Industry">Industry</option>
            <option value="Labour Force Statistics">
              Labour Force Statistics
            </option>
            <option value="National Accounts">National Accounts</option>
            <option value="National Health Accounts">
              National Health Accounts
            </option>
            <option value="Pakistan Social And Living Standards Measurement">
              Pakistan Social And Living Standards Measurement
            </option>
            <option value="Population Welfare Statistics">
              Population Welfare Statistics
            </option>
            <option value="Price Statistics">Price Statistics</option>
            <option value="Decision Support System for Inflation">
              Decision Support System for Inflation
            </option>
            <option value="Survey on COVID-19">Survey on COVID-19</option>
            <option value="Social Statistics">Social Statistics</option>
            <option value="Field Services">Field Services</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="data_format" class="form-label"
            >Requested Data Format *</label
          >
          <select
            class="form-select"
            id="data_format"
            name="data_format"
            required
          >
            <option value="">Select Format</option>
            <option value="CSV">CSV</option>
            <option value="Excel">Excel</option>
            <option value="PDF">PDF</option>
            <option value="JSON">JSON</option>
          </select>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label"
        >Description of the Data Needed *</label
      >
      <textarea
        class="form-control"
        id="description"
        name="description"
        rows="4"
        required
      ></textarea>
    </div>

    <!-- Timeline Information Section -->
    <div class="section-header mb-3 mt-4">Timeline Information</div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="requested_date" class="form-label"
            >Requested Date *</label
          >
          <input
            type="date"
            class="form-control"
            id="requested_date"
            name="requested_date"
            required
          />
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="urgency_level" class="form-label">Urgency Level *</label>
          <select
            class="form-select"
            id="urgency_level"
            name="urgency_level"
            required
          >
            <option value="">Select Urgency</option>
            <option value="Low">Low</option>
            <option value="Medium">Medium</option>
            <option value="High">High</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="deadline" class="form-label">Deadline (if any)</label>
          <input
            type="date"
            class="form-control"
            id="deadline"
            name="deadline"
          />
        </div>
      </div>
    </div>

    <!-- Additional Information Section -->
    <div class="section-header mb-3 mt-4">Additional Information</div>

    <div class="mb-3">
      <label for="comments" class="form-label">Comments</label>
      <textarea
        class="form-control"
        id="comments"
        name="comments"
        rows="3"
      ></textarea>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
      <a href="{{ url_for('dashboard') }}" class="btn btn-secondary me-md-2"
        >Cancel</a
      >
      <button type="submit" class="btn btn-primary">Submit Request</button>
    </div>
  </form>
</div>

<script>
  // Set default date to today
  document.getElementById("requested_date").value = new Date()
    .toISOString()
    .split("T")[0];

  // Form validation
  document.querySelector("form").addEventListener("submit", function (e) {
    const requiredFields = document.querySelectorAll("[required]");
    let isValid = true;

    requiredFields.forEach((field) => {
      if (!field.value.trim()) {
        field.classList.add("is-invalid");
        isValid = false;
      } else {
        field.classList.remove("is-invalid");
      }
    });

    if (!isValid) {
      e.preventDefault();
      alert("Please fill in all required fields.");
    }
  });

  // Remove invalid class when user starts typing
  document.querySelectorAll("input, select, textarea").forEach((field) => {
    field.addEventListener("input", function () {
      if (this.value.trim()) {
        this.classList.remove("is-invalid");
      }
    });
  });
</script>
{% endblock %}
